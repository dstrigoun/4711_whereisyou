<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="295520609347-3eh8b32dh01l05943610r81oh4m9thc1.apps.googleusercontent.com">
    <link rel="stylesheet" type="text/css" href="landingpage.css">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <title>Document</title>
</head>
<body>
  <div>
    <div id=photo-container>
      <img id = "banner" src="./image/planet-earth-space.jpg" alt="planet">
      <div class = "bg-text">
          <h1 id = "title">Where is I?</h1>
          <p id ="info-paragraph">This game allow players of all ages to enhance their geography skills and to provide them with boredom relief. 
            The rule to the game is simple. A random location is generated in the street view and the user is allow to move around to gather clues on their whereabouts. 
            Once the player know where they are, they can select their location on the mini map. A score is calculated depending on the distance the guess is from the source.
            If the player needs additional help, they can receive a social media hint with some points deductions.
          </p></div>
          <div id=google-button-container>
              <h1></h1>
              <p>Sign In and enjoy playing Where is I?</p>
              <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
          </div>
      </div>
      
    </div>
    
  
    
    
  <script>

  function getExternalToken() {
    let request = new XMLHttpRequest();

    request.open('GET', 'https://whereisyou.herokuapp.com/keys.php', true);
    request.setRequestHeader('key', 'bbc8e0e1-2dd4-4bc6-9f7d-1a0b3c5a3668');
    
    request.onload = function() {
        // Begin accessing JSON data here
        let data = JSON.parse(this.response);

        if (request.status >= 200 && request.status < 400) {
            sessionStorage.setItem("key", data);
        }
    }

    request.send();
  }

  function onSignIn(googleUser) {
      
    // Useful data for your client-side scripts:
    let profile = googleUser.getBasicProfile();
    console.log("ID: " + profile.getId()); // Don't send this directly to your server!
    console.log('Full Name: ' + profile.getName());
    console.log('Given Name: ' + profile.getGivenName());
    console.log('Family Name: ' + profile.getFamilyName());
    console.log("Image URL: " + profile.getImageUrl());
    console.log("Email: " + profile.getEmail());

    // The ID token you need to pass to your backend:
    let id_token = googleUser.getAuthResponse().id_token;
    console.log("ID Token: " + id_token);

    let params = {}
    params.email = profile.getEmail();
    params.firstName = profile.getGivenName();
    params.lastName = profile.getFamilyName();

    localStorage.removeItem("email");
    localStorage.setItem("email", profile.getEmail());
    localStorage.setItem("index", 0);
    localStorage.setItem("totalscore", 0);

    // //HTTPS POST request
    let xhr = new XMLHttpRequest();
    xhr.open('POST', 'https://jeffchoy.ca/comp4711/badgr-app/users');
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('authorization', 'bbc8e0e1-2dd4-4bc6-9f7d-1a0b3c5a3668');
    xhr.onload = function() {
      console.log('Signed in as: ' + xhr.responseText);
    };
    xhr.send(JSON.stringify(params));

    xhr.onreadystatechange = function(){
      if(this.readyState == 4 && this.status == 200) {
        location.href = "game.html";
      }
    }
  }  
  </script> 
  <script>
      getExternalToken();
  </script>
</body>
</html>
